{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stock Sentiment Tracker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            padding: 30px;
            font-family: 'Segoe UI', sans-serif;
        }
        .form-inline {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .headline-list {
            list-style-type: disc;
            padding-left: 20px;
        }
        .headline-list li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
<div class="container text-center">
    <h1 class="mb-4">
        ðŸ“Š <strong>Stock Sentiment Tracker</strong>
    </h1>

    <form method="POST" class="form-inline mb-4">
        {% csrf_token %}
        <input type="text" name="ticker" class="form-control" placeholder="Enter Stock Ticker (e.g. AAPL)" required style="width: 300px;">
        <button type="submit" class="btn btn-success">Analyze Sentiment</button>
    </form>

    {% if ticker %}
    <!-- Sentiment Info -->
    <div class="mb-4">
        <h4>
    Sentiment for <strong>{{ ticker }}</strong>: 
    <span class="{% if sentiment == 'Positive' %}text-success{% elif sentiment == 'Negative' %}text-danger{% else %}text-secondary{% endif %}">
        {{ sentiment }}
    </span>
    <small class="text-muted" title="Analyzed using FinBERT model">(FinBERT)</small>
</h4>

        {% if polarity_score %}
            <p><em>Polarity Score:</em> {{ polarity_score|floatformat:2 }}</p>
        {% endif %}
    </div>

    <!-- Bootstrap Tabs -->
    <ul class="nav nav-tabs" id="sentimentTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="headlines-tab" data-bs-toggle="tab" data-bs-target="#headlines" type="button" role="tab">ðŸ“° Headlines</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="stock-tab" data-bs-toggle="tab" data-bs-target="#stock" type="button" role="tab">ðŸ“ˆ Stock Price</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="sentiment-tab" data-bs-toggle="tab" data-bs-target="#historical" type="button" role="tab">ðŸ§  Sentiment History</button>
        </li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content p-4 border border-top-0 rounded-bottom" id="sentimentTabsContent">
        <!-- Headlines Tab -->
        <div class="tab-pane fade show active" id="headlines" role="tabpanel">
            {% if headlines %}
                <ul class="headline-list text-start">
                    {% for h in headlines %}
                        <li>{{ h }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No finance-related headlines found.</p>
            {% endif %}
        </div>

        <!-- Stock Price Chart Tab -->
        <div class="tab-pane fade" id="stock" role="tabpanel">
            <h5><strong>ðŸ’² Latest Stock Price:</strong> ${{ stock_price }}</h5>
            {% if chart_html %}
                {{ chart_html|safe }}
            {% else %}
                <p>Chart unavailable.</p>
            {% endif %}
        </div>

        <!-- Historical Sentiment Chart Tab -->
        <div class="tab-pane fade" id="historical" role="tabpanel">
            {% if sentiment_chart %}
                <div id="sentimentChart"></div>
                <script>
                    var sentimentPlot = {{ sentiment_chart|safe }};
                    {% comment %} Plotly.newPlot('sentimentChart', sentimentPlot.data, sentimentPlot.layout); {% endcomment %}
                </script>
            {% else %}
                <p>No sentiment history available.</p>
            {% endif %}
        </div>
    </div>
    {% if headlines %}
    <div class="mt-3">
        <a href="{% url 'download_csv' %}?{% for h in headlines %}headlines={{ h|urlencode }}&{% endfor %}sentiment={{ sentiment }}&polarity={{ polarity_score }}" class="btn btn-outline-primary">ðŸ“„ Download CSV</a>

        <a href="{% url 'download_pdf' %}?{% for h in headlines %}headlines={{ h|urlencode }}&{% endfor %}sentiment={{ sentiment }}&polarity={{ polarity_score }}" class="btn btn-outline-success">ðŸ§¾ Download PDF</a>
    </div>
{% endif %}

    {% endif %}
</div>

<!-- Bootstrap JS for tabs -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
